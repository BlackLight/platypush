(self["webpackChunkplatypush"]=self["webpackChunkplatypush"]||[]).push([[9892],{4964:function(t,e,n){var i=n(5112),r=i("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[r]=!1,"/./"[t](e)}catch(i){}}return!1}},3929:function(t,e,n){var i=n(7850),r=TypeError;t.exports=function(t){if(i(t))throw r("The method doesn't accept regular expressions");return t}},6755:function(t,e,n){"use strict";var i=n(2109),r=n(1702),o=n(1236).f,u=n(7466),l=n(1340),s=n(3929),a=n(4488),c=n(4964),d=n(1913),f=r("".startsWith),p=r("".slice),v=Math.min,m=c("startsWith"),h=!d&&!m&&!!function(){var t=o(String.prototype,"startsWith");return t&&!t.writable}();i({target:"String",proto:!0,forced:!h&&!m},{startsWith:function(t){var e=l(a(this));s(t);var n=u(v(arguments.length>1?arguments[1]:void 0,e.length)),i=l(t);return f?f(e,i,n):p(e,n,n+i.length)===i}})},9892:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return c}});var i=n(6252),r={class:"row item entity-container"};function o(t,e,n,o,u,l){var s;return(0,i.wg)(),(0,i.iD)("div",r,[((0,i.wg)(),(0,i.j4)((0,i.LL)(u.component),{value:t.value,loading:t.loading,error:t.error||0==(null===(s=t.value)||void 0===s?void 0:s.reachable),onInput:e[0]||(e[0]=function(e){return t.$emit("input",e)}),onLoading:e[1]||(e[1]=function(e){return t.$emit("loading",e)})},null,8,["value","loading","error"]))])}n(1539),n(8783),n(3948);var u=n(7909),l={name:"Entity",mixins:[u["default"]],emits:["input","loading"],data:function(){return{component:null}},mounted:function(){var t=this;"Entity"!==this.type&&(this.component=(0,i.RC)((function(){return n(7243)("./".concat(t.type))})))}},s=n(3744);const a=(0,s.Z)(l,[["render",o],["__scopeId","data-v-3c242632"]]);var c=a},7909:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return u}});n(7042);var i=n(6813),r={name:"EntityMixin",mixins:[i.Z],emits:["input"],props:{loading:{type:Boolean,default:!1},error:{type:Boolean,default:!1},value:{type:Object,required:!0}},data:function(){return{modalVisible:!1}},computed:{type:function(){var t=this.value.type||"";return t.charAt(0).toUpperCase()+t.slice(1)}}};const o=r;var u=o},914:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return A}});n(7941),n(8309);var i=n(6252),r=n(3577),o=function(t){return(0,i.dD)("data-v-fef021ee"),t=t(),(0,i.Cn)(),t},u={class:"row plugin entities-container"},l={class:"col-11 left"},s={class:"col-1 right"},a=o((function(){return(0,i._)("i",{class:"fa fa-sync-alt"},null,-1)})),c=[a],d={class:"groups-canvas"},f=(0,i.Uk)("No entities found"),p={key:2,class:"groups-container"},v={class:"frame"},m={class:"header"},h={class:"section left"},y={class:"section center"},g=["textContent"],w=["textContent"],_={class:"section right"},b=["onClick"],k=o((function(){return(0,i._)("i",{class:"fa fa-sync-alt"},null,-1)})),E=[k],x={class:"body"},C=["onClick"];function I(t,e,n,o,a,k){var I,D=(0,i.up)("Loading"),G=(0,i.up)("Selector"),T=(0,i.up)("EntityModal"),Z=(0,i.up)("NoItems"),j=(0,i.up)("Icon"),S=(0,i.up)("Entity");return(0,i.wg)(),(0,i.iD)("div",u,[a.loading?((0,i.wg)(),(0,i.j4)(D,{key:0})):(0,i.kq)("",!0),(0,i._)("header",null,[(0,i._)("div",l,[(0,i.Wm)(G,{"entity-groups":k.entityGroups,value:a.selector,onInput:e[0]||(e[0]=function(t){return a.selector=t})},null,8,["entity-groups","value"])]),(0,i._)("div",s,[(0,i._)("button",{title:"Refresh",onClick:e[1]||(e[1]=function(t){return k.refresh(null)})},c)])]),(0,i._)("div",d,[a.modalEntityId?((0,i.wg)(),(0,i.j4)(T,{key:0,entity:a.entities[a.modalEntityId],visible:a.modalVisible,onClose:e[2]||(e[2]=function(t){return k.onEntityModal(null)})},null,8,["entity","visible"])):(0,i.kq)("",!0),null!==(I=Object.keys(k.displayGroups||{}))&&void 0!==I&&I.length?((0,i.wg)(),(0,i.iD)("div",p,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(k.displayGroups,(function(t){var e,n;return(0,i.wg)(),(0,i.iD)("div",{class:"group fade-in",key:t.name},[(0,i._)("div",v,[(0,i._)("div",m,[(0,i._)("span",h,["type"===a.selector.grouping&&k.entitiesMeta[t.name]?((0,i.wg)(),(0,i.j4)(j,(0,r.vs)((0,i.dG)({key:0},k.entitiesMeta[t.name].icon||{})),null,16)):"plugin"===a.selector.grouping&&k.pluginIcons[t.name]?((0,i.wg)(),(0,i.j4)(j,{key:1,class:(0,r.C_)(null===(e=k.pluginIcons[t.name])||void 0===e?void 0:e.class),url:null===(n=k.pluginIcons[t.name])||void 0===n?void 0:n.imgUrl},null,8,["class","url"])):(0,i.kq)("",!0)]),(0,i._)("span",y,["type"===a.selector.grouping&&k.entitiesMeta[t.name]?((0,i.wg)(),(0,i.iD)("div",{key:0,class:"title",textContent:(0,r.zw)(k.entitiesMeta[t.name].name_plural)},null,8,g)):"plugin"===a.selector.grouping?((0,i.wg)(),(0,i.iD)("div",{key:1,class:"title",textContent:(0,r.zw)(t.name)},null,8,w)):(0,i.kq)("",!0)]),(0,i._)("span",_,[(0,i._)("button",{title:"Refresh",onClick:function(e){return k.refresh(t)}},E,8,b)])]),(0,i._)("div",x,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.entities,(function(t){return(0,i.wg)(),(0,i.iD)("div",{class:"entity-frame",onClick:function(e){return k.onEntityModal(t.id)},key:t.id},[(0,i.Wm)(S,{value:t,onInput:k.onEntityInput,error:!!a.errorEntities[t.id],loading:!!a.loadingEntities[t.id],onLoading:function(e){return a.loadingEntities[t.id]=e}},null,8,["value","onInput","error","loading","onLoading"])],8,C)})),128))])])])})),128))])):((0,i.wg)(),(0,i.j4)(Z,{key:1},{default:(0,i.w5)((function(){return[f]})),_:1}))])])}var D=n(4648),G=n(8534),T=n(6084),Z=(n(5666),n(9653),n(1539),n(9720),n(1249),n(2707),n(7327),n(2479),n(6813)),j=n(1232),S=n(1478),O={class:"no-items-container"},q={class:"no-items fade-in"};function M(t,e,n,r,o,u){return(0,i.wg)(),(0,i.iD)("div",O,[(0,i._)("div",q,[(0,i.WI)(t.$slots,"default",{},void 0,!0)])])}var U={name:"NoItems"},R=n(3744);const N=(0,R.Z)(U,[["render",M],["__scopeId","data-v-6fec32b5"]]);var $=N,L=n(9892),z=n(6647),W=n(4117),F=n(1359),V=n(7369),B={name:"Entities",components:{Loading:j.Z,Icon:S.Z,Entity:L["default"],Selector:z["default"],NoItems:$,EntityModal:W["default"]},mixins:[Z.Z],props:{entityScanTimeout:{type:Number,default:30}},data:function(){return{loading:!1,loadingEntities:{},errorEntities:{},entityTimeouts:{},entities:{},modalEntityId:null,modalVisible:!1,selector:{grouping:"type",selectedEntities:{}}}},computed:{entitiesMeta:function(){return V},pluginIcons:function(){return F},entityGroups:function(){return{id:Object.entries(this.groupEntities("id")).reduce((function(t,e){var n=(0,T.Z)(e,2),i=n[0],r=n[1];return t[i]=r[0],t}),{}),type:this.groupEntities("type"),plugin:this.groupEntities("plugin")}},displayGroups:function(){var t=this;return Object.entries(this.entityGroups[this.selector.grouping]).filter((function(e){return e[1].filter((function(e){return!!t.selector.selectedEntities[e.id]})).length>0})).sort((function(t,e){return t[0].localeCompare(e[0])})).map((function(e){var n=(0,T.Z)(e,2),i=n[0],r=n[1];return{name:i,entities:r.filter((function(e){return e.id in t.selector.selectedEntities}))}}))}},methods:{groupEntities:function(t){return Object.values(this.entities).reduce((function(e,n){var i=e[n[t]]||{};return i[n.id]=n,e[n[t]]=Object.values(i).sort((function(t,e){return t.name.localeCompare(e.name)})),e}),{})},refresh:function(t){var e=this;return(0,G.Z)(regeneratorRuntime.mark((function n(){var i,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=(t?t.entities:e.entities)||{},r={},t&&(r.plugins=Object.keys(i.reduce((function(t,e){return t[e.plugin]=!0,t}),{}))),e.loadingEntities=Object.values(i).reduce((function(t,n){var i=e,r=n.id;return e.entityTimeouts[r]&&clearTimeout(e.entityTimeouts[r]),e.entityTimeouts[r]=setTimeout((function(){i.loadingEntities[r]&&delete i.loadingEntities[r],i.entityTimeouts[r]&&delete i.entityTimeouts[r],i.errorEntities[r]=n,i.notify({error:!0,title:n.plugin,text:"Scan timeout for ".concat(n.name)})}),1e3*e.entityScanTimeout),t[r]=!0,t}),{}),n.next=6,e.request("entities.scan",r);case 6:case"end":return n.stop()}}),n)})))()},sync:function(){var t=this;return(0,G.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,t.request("entities.get");case 4:t.entities=e.sent.reduce((function(t,e){var n;return e.name=(null===e||void 0===e||null===(n=e.meta)||void 0===n?void 0:n.name_override)||e.name,e.meta=(0,D.Z)((0,D.Z)({},V[e.type]||{}),e.meta||{}),t[e.id]=e,t}),{}),t.selector.selectedEntities=t.entityGroups.id;case 6:return e.prev=6,t.loading=!1,e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[1,,6,9]])})))()},clearEntityTimeouts:function(t){this.errorEntities[t]&&delete this.errorEntities[t],this.loadingEntities[t]&&delete this.loadingEntities[t],this.entityTimeouts[t]&&(clearTimeout(this.entityTimeouts[t]),delete this.entityTimeouts[t])},onEntityInput:function(t){this.entities[t.id]=t,this.clearEntityTimeouts(t.id),this.loadingEntities[t.id]&&delete this.loadingEntities[t.id]},onEntityUpdate:function(t){var e,n,i,r,o,u,l,s,a,c,d,f=t.entity.id;if(null!=f){this.clearEntityTimeouts(f);var p=(0,D.Z)({},t.entity);null==(null===(e=t.entity)||void 0===e?void 0:e.state)&&(p.state=null===(n=this.entities[f])||void 0===n?void 0:n.state),null!==(i=p.meta)&&void 0!==i&&null!==(r=i.name_override)&&void 0!==r&&r.length?p.name=p.meta.name_override:null!==(o=this.entities[f])&&void 0!==o&&null!==(u=o.meta)&&void 0!==u&&null!==(l=u.name_override)&&void 0!==l&&l.length?p.name=this.entities[f].meta.name_override:p.name=(null===(s=t.entity)||void 0===s?void 0:s.name)||(null===(a=this.entities[f])||void 0===a?void 0:a.name),p.meta=(0,D.Z)((0,D.Z)((0,D.Z)({},V[t.entity.type]||{}),(null===(c=this.entities[f])||void 0===c?void 0:c.meta)||{}),(null===(d=t.entity)||void 0===d?void 0:d.meta)||{}),this.entities[f]=p}},onEntityDelete:function(t){var e,n=null===(e=t.entity)||void 0===e?void 0:e.id;null!=n&&(n===this.modalEntityId&&(this.modalEntityId=null),this.entities[n]&&delete this.entities[n])},onEntityModal:function(t){t?(this.modalEntityId=t,this.modalVisible=!0):(this.modalEntityId=null,this.modalVisible=!1)}},mounted:function(){var t=this;return(0,G.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.subscribe(t.onEntityUpdate,"on-entity-update","platypush.message.event.entities.EntityUpdateEvent"),t.subscribe(t.onEntityDelete,"on-entity-delete","platypush.message.event.entities.EntityDeleteEvent"),e.next=4,t.sync();case 4:return e.next=6,t.refresh();case 6:case"end":return e.stop()}}),e)})))()}};const K=(0,R.Z)(B,[["render",I],["__scopeId","data-v-fef021ee"]]);var A=K},4117:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return Lt}});n(8309),n(2526),n(1817);var i=n(6252),r=n(3577),o=function(t){return(0,i.dD)("data-v-ada8d74e"),t=t(),(0,i.Cn)(),t},u=(0,i.Uk)(" Are you "),l=o((function(){return(0,i._)("b",null,"sure",-1)})),s=(0,i.Uk)(" that you want to delete this entity? "),a=o((function(){return(0,i._)("br",null,null,-1)})),c=o((function(){return(0,i._)("br",null,null,-1)})),d=(0,i.Uk)(" Note: you should only delete an entity if its plugin has been disabled or the entity is no longer reachable."),f=o((function(){return(0,i._)("br",null,null,-1)})),p=o((function(){return(0,i._)("br",null,null,-1)})),v=(0,i.Uk)(" Otherwise, the entity will simply be created again upon the next scan. "),m={class:"table-row"},h={class:"title"},y=(0,i.Uk)(" Name "),g={class:"value"},w=["textContent"],_={class:"table-row"},b={class:"title"},k=(0,i.Uk)(" Icon "),E={class:"value icon-canvas"},x={key:0,class:"icon-editor"},C=o((function(){return(0,i._)("i",{class:"fas fa-rotate-left"},null,-1)})),I=[C],D=o((function(){return(0,i._)("span",{class:"help"},[(0,i.Uk)(" Supported: image URLs or "),(0,i._)("a",{href:"https://fontawesome.com/icons",target:"_blank"},"FontAwesome icon classes"),(0,i.Uk)(". ")],-1)})),G={class:"table-row"},T=o((function(){return(0,i._)("div",{class:"title"}," Icon color ",-1)})),Z={class:"value icon-color-picker"},j=["value"],S=o((function(){return(0,i._)("i",{class:"fas fa-rotate-left"},null,-1)})),O=[S],q={class:"table-row"},M=o((function(){return(0,i._)("div",{class:"title"},"Plugin",-1)})),U=["textContent"],R={class:"table-row"},N=o((function(){return(0,i._)("div",{class:"title"},"Internal ID",-1)})),$=["textContent"],L={key:0,class:"table-row"},z=o((function(){return(0,i._)("div",{class:"title"},"External ID",-1)})),W=["textContent"],F={key:1,class:"table-row"},V=o((function(){return(0,i._)("div",{class:"title"},"Description",-1)})),B=["textContent"],K={key:0,class:"table-row"},A=["textContent"],H=["textContent"],Y={key:2,class:"table-row"},P=o((function(){return(0,i._)("div",{class:"title"},"Created at",-1)})),J=["textContent"],Q={key:3,class:"table-row"},X=o((function(){return(0,i._)("div",{class:"title"},"Updated at",-1)})),tt=["textContent"],et={class:"table-row delete-entity-container"},nt=o((function(){return(0,i._)("div",{class:"title"},"Delete Entity",-1)})),it={class:"value"},rt=o((function(){return(0,i._)("i",{class:"fas fa-trash"},null,-1)})),ot=[rt];function ut(t,e,n,o,C,S){var rt=(0,i.up)("ConfirmDialog"),ut=(0,i.up)("EditButton"),lt=(0,i.up)("NameEditor"),st=(0,i.up)("Icon"),at=(0,i.up)("Modal",!0);return(0,i.wg)(),(0,i.j4)(at,{visible:n.visible,title:n.entity.name||n.entity.external_id},{default:(0,i.w5)((function(){var o,at,ct,dt,ft,pt,vt,mt;return[(0,i.Wm)(rt,{ref:"deleteConfirmDiag",title:"Confirm entity deletion",onInput:S.onDelete},{default:(0,i.w5)((function(){return[u,l,s,a,c,d,f,p,v]})),_:1},8,["onInput"]),(0,i._)("div",m,[(0,i._)("div",h,[y,C.editName?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(ut,{key:0,onClick:e[0]||(e[0]=function(t){return C.editName=!0})}))]),(0,i._)("div",g,[C.editName?((0,i.wg)(),(0,i.j4)(lt,{key:0,value:n.entity.name,onInput:S.onRename,onCancel:e[1]||(e[1]=function(t){return C.editName=!1}),disabled:C.loading},null,8,["value","onInput","disabled"])):((0,i.wg)(),(0,i.iD)("span",{key:1,textContent:(0,r.zw)(n.entity.name)},null,8,w))])]),(0,i._)("div",_,[(0,i._)("div",b,[k,C.editIcon?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(ut,{key:0,onClick:e[2]||(e[2]=function(t){return C.editIcon=!0})}))]),(0,i._)("div",E,[C.editIcon?((0,i.wg)(),(0,i.iD)("span",x,[(0,i.Wm)(lt,{value:(null===(o=n.entity.meta)||void 0===o||null===(at=o.icon)||void 0===at?void 0:at.class)||(null===(ct=n.entity.meta)||void 0===ct||null===(dt=ct.icon)||void 0===dt?void 0:dt.url),onInput:S.onIconEdit,onCancel:e[5]||(e[5]=function(t){return C.editIcon=!1}),disabled:C.loading},{default:(0,i.w5)((function(){return[(0,i._)("button",{type:"button",title:"Reset",onClick:e[3]||(e[3]=function(t){return S.onIconEdit(null)}),onTouch:e[4]||(e[4]=function(t){return S.onIconEdit(null)})},I,32)]})),_:1},8,["value","onInput","disabled"]),D])):((0,i.wg)(),(0,i.j4)(st,(0,r.vs)((0,i.dG)({key:1},(null===(ft=n.entity)||void 0===ft||null===(pt=ft.meta)||void 0===pt?void 0:pt.icon)||{})),null,16))])]),(0,i._)("div",G,[T,(0,i._)("div",Z,[(0,i._)("input",{type:"color",value:null===(vt=n.entity.meta)||void 0===vt||null===(mt=vt.icon)||void 0===mt?void 0:mt.color,onChange:e[6]||(e[6]=function(){return S.onIconColorEdit&&S.onIconColorEdit.apply(S,arguments)})},null,40,j),(0,i._)("button",{type:"button",title:"Reset",onClick:e[7]||(e[7]=function(t){return S.onIconColorEdit(null)}),onTouch:e[8]||(e[8]=function(t){return S.onIconColorEdit(null)})},O,32)])]),(0,i._)("div",q,[M,(0,i._)("div",{class:"value",textContent:(0,r.zw)(n.entity.plugin)},null,8,U)]),(0,i._)("div",R,[N,(0,i._)("div",{class:"value",textContent:(0,r.zw)(n.entity.id)},null,8,$)]),n.entity.external_id?((0,i.wg)(),(0,i.iD)("div",L,[z,(0,i._)("div",{class:"value",textContent:(0,r.zw)(n.entity.external_id)},null,8,W)])):(0,i.kq)("",!0),n.entity.description?((0,i.wg)(),(0,i.iD)("div",F,[V,(0,i._)("div",{class:"value",textContent:(0,r.zw)(n.entity.description)},null,8,B)])):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.entity.data||{},(function(e,n){return(0,i.wg)(),(0,i.iD)("div",{key:n},[null!=e?((0,i.wg)(),(0,i.iD)("div",K,[(0,i._)("div",{class:"title",textContent:(0,r.zw)(t.prettify(n))},null,8,A),(0,i._)("div",{class:"value",textContent:(0,r.zw)(""+e)},null,8,H)])):(0,i.kq)("",!0)])})),128)),n.entity.created_at?((0,i.wg)(),(0,i.iD)("div",Y,[P,(0,i._)("div",{class:"value",textContent:(0,r.zw)(t.formatDateTime(n.entity.created_at))},null,8,J)])):(0,i.kq)("",!0),n.entity.updated_at?((0,i.wg)(),(0,i.iD)("div",Q,[X,(0,i._)("div",{class:"value",textContent:(0,r.zw)(t.formatDateTime(n.entity.updated_at))},null,8,tt)])):(0,i.kq)("",!0),(0,i._)("div",et,[nt,(0,i._)("div",it,[(0,i._)("button",{onClick:e[9]||(e[9]=function(e){return t.$refs.deleteConfirmDiag.show()})},ot)])])]})),_:1},8,["visible","title"])}var lt=n(8534),st=(n(6755),n(5666),n(9642)),at=n(1478),ct=n(9963),dt=function(t){return(0,i.dD)("data-v-d543b3e4"),t=t(),(0,i.Cn)(),t},ft={class:"dialog-content"},pt=dt((function(){return(0,i._)("i",{class:"fas fa-check"},null,-1)})),vt=dt((function(){return(0,i._)("i",{class:"fas fa-xmark"},null,-1)}));function mt(t,e,n,o,u,l){var s=(0,i.up)("Modal");return(0,i.wg)(),(0,i.j4)(s,{ref:"modal",title:n.title},{default:(0,i.w5)((function(){return[(0,i._)("div",ft,[(0,i.WI)(t.$slots,"default",{},void 0,!0)]),(0,i._)("form",{class:"buttons",onSubmit:e[4]||(e[4]=(0,ct.iM)((function(){return l.onConfirm&&l.onConfirm.apply(l,arguments)}),["prevent"]))},[(0,i._)("button",{type:"submit",class:"ok-btn",onClick:e[0]||(e[0]=function(){return l.onConfirm&&l.onConfirm.apply(l,arguments)}),onTouch:e[1]||(e[1]=function(){return l.onConfirm&&l.onConfirm.apply(l,arguments)})},[pt,(0,i.Uk)("   "+(0,r.zw)(n.confirmText),1)],32),(0,i._)("button",{type:"button",class:"cancel-btn",onClick:e[2]||(e[2]=function(){return l.close&&l.close.apply(l,arguments)}),onTouch:e[3]||(e[3]=function(){return l.close&&l.close.apply(l,arguments)})},[vt,(0,i.Uk)("   "+(0,r.zw)(n.cancelText),1)],32)],32)]})),_:3},8,["title"])}var ht={emits:["input","click","touch"],components:{Modal:st.Z},props:{title:{type:String},confirmText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"}},methods:{onConfirm:function(){this.$emit("input"),this.close()},show:function(){this.$refs.modal.show()},close:function(){this.$refs.modal.hide()}}},yt=n(3744);const gt=(0,yt.Z)(ht,[["render",mt],["__scopeId","data-v-d543b3e4"]]);var wt=gt,_t=function(t){return(0,i.dD)("data-v-3344f2bf"),t=t(),(0,i.Cn)(),t},bt=_t((function(){return(0,i._)("i",{class:"fas fa-pen-to-square"},null,-1)})),kt=[bt];function Et(t,e,n,r,o,u){return(0,i.wg)(),(0,i.iD)("button",{class:"edit-btn",onClick:e[0]||(e[0]=function(t){return u.proxy(t)}),onTouch:e[1]||(e[1]=function(t){return u.proxy(t)}),onInput:e[2]||(e[2]=function(t){return u.proxy(t)})},kt,32)}var xt={emits:["input","click","touch"],methods:{proxy:function(t){this.$emit(t.type,t)}}};const Ct=(0,yt.Z)(xt,[["render",Et],["__scopeId","data-v-3344f2bf"]]);var It=Ct,Dt=function(t){return(0,i.dD)("data-v-1405d90f"),t=t(),(0,i.Cn)(),t},Gt=["disabled"],Tt=Dt((function(){return(0,i._)("button",{type:"submit"},[(0,i._)("i",{class:"fas fa-circle-check"})],-1)})),Zt=Dt((function(){return(0,i._)("i",{class:"fas fa-ban"},null,-1)})),jt=[Zt];function St(t,e,n,r,o,u){return(0,i.wg)(),(0,i.iD)("form",{onSubmit:e[3]||(e[3]=(0,ct.iM)((function(){return u.submit&&u.submit.apply(u,arguments)}),["prevent"])),class:"name-editor"},[(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=function(t){return o.text=t}),disabled:n.disabled},null,8,Gt),[[ct.nr,o.text]]),Tt,(0,i._)("button",{class:"cancel",onClick:e[1]||(e[1]=function(e){return t.$emit("cancel")}),onTouch:e[2]||(e[2]=function(e){return t.$emit("cancel")})},jt,32),(0,i.WI)(t.$slots,"default",{},void 0,!0)],32)}var Ot={emits:["input","cancel"],props:{value:{type:String},disabled:{type:Boolean,deafult:!1}},data:function(){return{text:null}},methods:{proxy:function(t){this.$emit(t.type,t)},submit:function(){return this.$emit("input",this.text),!1}},mounted:function(){this.text=this.value}};const qt=(0,yt.Z)(Ot,[["render",St],["__scopeId","data-v-1405d90f"]]);var Mt=qt,Ut=n(6813),Rt=n(7369),Nt={name:"Entity",components:{Modal:st.Z,EditButton:It,NameEditor:Mt,Icon:at.Z,ConfirmDialog:wt},mixins:[Ut.Z],emits:["input","loading"],props:{entity:{type:Object,required:!0},visible:{type:Boolean,default:!1}},data:function(){return{loading:!1,editName:!1,editIcon:!1}},methods:{onRename:function(t){var e=this;return(0,lt.Z)(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.loading=!0,n.prev=1,i={},i[e.entity.id]=t,n.next=6,e.request("entities.rename",i);case 6:return n.prev=6,e.loading=!1,e.editName=!1,n.finish(6);case 10:case"end":return n.stop()}}),n,null,[[1,,6,10]])})))()},onDelete:function(){var t=this;return(0,lt.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,t.request("entities.delete",[t.entity.id]);case 4:return e.prev=4,t.loading=!1,e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[1,,4,7]])})))()},onIconEdit:function(t){var e=this;return(0,lt.Z)(regeneratorRuntime.mark((function n(){var i,r,o,u,l,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.loading=!0,n.prev=1,i={url:null,class:null},null!==t&&void 0!==t&&t.length?t.startsWith("http")?i.url=t:i.class=t:(i.url=null===(r=Rt[e.entity.type]||{})||void 0===r||null===(o=r.icon)||void 0===o?void 0:o.url,i.class=null===(u=Rt[e.entity.type]||{})||void 0===u||null===(l=u.icon)||void 0===l?void 0:l["class"]),s={},s[e.entity.id]={icon:i},n.next=8,e.request("entities.set_meta",s);case 8:return n.prev=8,e.loading=!1,e.editIcon=!1,n.finish(8);case 12:case"end":return n.stop()}}),n,null,[[1,,8,12]])})))()},onIconColorEdit:function(t){var e=this;return(0,lt.Z)(regeneratorRuntime.mark((function n(){var i,r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.loading=!0,n.prev=1,r=(null===(i=e.entity.meta)||void 0===i?void 0:i.icon)||{},r.color=t?t.target.value:null,o={},o[e.entity.id]={icon:r},n.next=8,e.request("entities.set_meta",o);case 8:return n.prev=8,e.loading=!1,e.editIcon=!1,n.finish(8);case 12:case"end":return n.stop()}}),n,null,[[1,,8,12]])})))()}}};const $t=(0,yt.Z)(Nt,[["render",ut],["__scopeId","data-v-ada8d74e"]]);var Lt=$t},6647:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return w}});n(7941);var i=n(6252),r=n(3577),o=n(9963),u={class:"entities-selectors-container"},l={class:"selector"},s={key:1,class:"selector"};function a(t,e,n,a,c,d){var f,p=(0,i.up)("DropdownItem"),v=(0,i.up)("Dropdown");return(0,i.wg)(),(0,i.iD)("div",u,[(0,i._)("div",l,[(0,i.Wm)(v,{title:"Group by","icon-class":"fas fa-eye",ref:"groupingSelector"},{default:(0,i.w5)((function(){return[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(d.visibleGroupings,(function(t){var e;return(0,i.wg)(),(0,i.j4)(p,{key:t,text:d.prettifyGroupingName(t),"item-class":{selected:(null===(e=n.value)||void 0===e?void 0:e.grouping)===t},onClick:function(e){return d.onGroupingChanged(t)}},null,8,["text","item-class","onClick"])})),128))]})),_:1},512)]),null!==(f=n.value)&&void 0!==f&&f.grouping?((0,i.wg)(),(0,i.iD)("div",{key:0,class:(0,r.C_)(["selector",{active:d.isGroupFilterActive}])},[(0,i.Wm)(v,{title:"Filter by","icon-class":"fas fa-filter",ref:"groupSelector","keep-open-on-item-click":""},{default:(0,i.w5)((function(){return[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(d.sortedGroups,(function(t){return(0,i.wg)(),(0,i.j4)(p,(0,i.dG)({key:t,text:t},d.iconForGroup(t),{"item-class":{selected:!!c.selectedGroups[t]},onClick:(0,o.iM)((function(e){return d.toggleGroup(t)}),["stop"])}),null,16,["text","item-class","onClick"])})),128))]})),_:1},512)],2)):(0,i.kq)("",!0),Object.keys(n.entityGroups.id||{}).length?((0,i.wg)(),(0,i.iD)("div",s,[(0,i.wy)((0,i._)("input",{ref:"search",type:"text",class:"search-bar",placeholder:"🔎","onUpdate:modelValue":e[0]||(e[0]=function(t){return c.searchTerm=t})},null,512),[[o.nr,c.searchTerm]])])):(0,i.kq)("",!0)])}var c=n(4648),d=(n(7327),n(1539),n(2707),n(2479),n(8309),n(9714),n(6813)),f=n(5771),p=n(9015),v=n(7369),m=n(1359),h={name:"Selector",emits:["input"],mixins:[d.Z],components:{Dropdown:f.Z,DropdownItem:p.Z},props:{entityGroups:{type:Object,required:!0},value:{type:Object,required:!0}},data:function(){return{selectedGroups:{},searchTerm:""}},computed:{visibleGroupings:function(){return Object.keys(this.entityGroups).filter((function(t){return"id"!==t}))},sortedGroups:function(){var t;return Object.keys(this.entityGroups[null===(t=this.value)||void 0===t?void 0:t.grouping]||{}).sort()},typesMeta:function(){return v},isGroupFilterActive:function(){return Object.keys(this.selectedGroups).length!==this.sortedGroups.length},selectedEntities:function(){var t=this;return Object.values(this.entityGroups.id).filter((function(e){var n,i;if(!t.selectedGroups[e[null===(n=t.value)||void 0===n?void 0:n.grouping]])return!1;if(null!==(i=t.searchTerm)&&void 0!==i&&i.length){var r=t.searchTerm.toLowerCase();return(e.name||"").toLowerCase().indexOf(r)>=0||(e.plugin||"").toLowerCase().indexOf(r)>=0||(e.external_id||"").toLowerCase().indexOf(r)>=0||(e.id||0).toString()==r}return!0})).reduce((function(t,e){return t[e.id]=e,t}),{})}},methods:{prettifyGroupingName:function(t){return t?this.prettify(t)+"s":""},iconForGroup:function(t){if("plugin"===this.value.grouping&&m[t]){var e,n,i=m[t];return{"icon-class":null!==(e=i["class"])&&void 0!==e&&e.length||null===(n=i.imgUrl)||void 0===n||!n.length?i["class"]:"fas fa-gears","icon-url":i.imgUrl}}return{}},synchronizeSelectedEntities:function(){var t=(0,c.Z)({},this.value);t.selectedEntities=this.selectedEntities,this.$emit("input",t)},updateSearchTerm:function(){var t=(0,c.Z)({},this.value);t.searchTerm=this.searchTerm,t.selectedEntities=this.selectedEntities,this.$emit("input",t)},refreshGroupFilter:function(t){var e;if(t)this.selectedGroups=Object.keys(this.entityGroups[null===(e=this.value)||void 0===e?void 0:e.grouping]||{}).reduce((function(t,e){return t[e]=!0,t}),{});else for(var n=0,i=Object.keys(this.entityGroups[null===(r=this.value)||void 0===r?void 0:r.grouping]);n<i.length;n++){var r,o=i[n];null==this.selectedGroups[o]&&(this.selectedGroups[o]=!0)}this.synchronizeSelectedEntities()},toggleGroup:function(t){this.selectedGroups[t]=!this.selectedGroups[t],this.synchronizeSelectedEntities()},onGroupingChanged:function(t){var e;if(!this.entityGroups[t]||t===(null===(e=this.value)||void 0===e?void 0:e.grouping))return!1;var n=(0,c.Z)({},this.value);n.grouping=t,this.$emit("input",n)}},mounted:function(){var t=this;this.refreshGroupFilter(!0),this.$watch((function(){var e;return null===(e=t.value)||void 0===e?void 0:e.grouping}),(function(){t.refreshGroupFilter(!0)})),this.$watch((function(){return t.searchTerm}),this.updateSearchTerm),this.$watch((function(){return t.entityGroups}),(function(){t.refreshGroupFilter(!1)}))}},y=n(3744);const g=(0,y.Z)(h,[["render",a],["__scopeId","data-v-63b80935"]]);var w=g},7243:function(t,e,n){var i={"./Entity":[9892,9],"./Entity.vue":[9892,9],"./EntityIcon":[3499,9,8729,3499],"./EntityIcon.vue":[3499,9,8729,3499],"./EntityMixin":[7909,9],"./EntityMixin.vue":[7909,9],"./Index":[914,9],"./Index.vue":[914,9],"./Light":[1155,9,3490,3803,8729,1155],"./Light.vue":[1155,9,3490,3803,8729,1155],"./Modal":[4117,9],"./Modal.vue":[4117,9],"./Selector":[6647,9],"./Selector.vue":[6647,9],"./Switch":[518,9,3490,8729,518],"./Switch.vue":[518,9,3490,8729,518],"./common.scss":[65,9,4981,65],"./meta":[7369,3],"./meta.json":[7369,3],"./vars.scss":[5207,9,4981,5207]};function r(t){if(!n.o(i,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=i[t],r=e[0];return Promise.all(e.slice(2).map(n.e)).then((function(){return n.t(r,16|e[1])}))}r.keys=function(){return Object.keys(i)},r.id=7243,t.exports=r},7369:function(t){"use strict";t.exports=JSON.parse('{"entity":{"name":"Entity","name_plural":"Entities","icon":{"class":"fas fa-circle-question"}},"device":{"name":"Device","name_plural":"Devices","icon":{"class":"fas fa-gear"}},"switch":{"name":"Switch","name_plural":"Switches","icon":{"class":"fas fa-toggle-on"}},"light":{"name":"Light","name_plural":"Lights","icon":{"class":"fas fa-lightbulb"}}}')}}]);
//# sourceMappingURL=9892-legacy.810d8db8.js.map